<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eldritch RPG 2nd Edition Character Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        select, button {
            font-size: 1em;
            padding: 5px 10px;
            margin: 10px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Eldritch RPG 2nd Edition Character Generator</h1>
    <div>
        <label for="race">Race:</label>
        <select id="race">
            <option value="">Select a race</option>
        </select>
    </div>
    <div>
        <label for="class">Class:</label>
        <select id="class">
            <option value="">Select a class</option>
        </select>
    </div>
    <div>
        <label for="level">Level:</label>
        <select id="level">
            <option value="">Select a level</option>
        </select>
    </div>
    <button onclick="generateCharacter()">Generate Character</button>
    <div id="character-output"></div>


    <script>
        const dieRanks = ['d4', 'd6', 'd8', 'd10', 'd12'];
        const focusBonuses = ['+0', '+1', '+2', '+3', '+4', '+5'];


        const abilities = ['Competence', 'Prowess', 'Fortitude'];
        const specialties = {
            Competence: ['Adroitness', 'Expertise', 'Perception'],
            Prowess: ['Agility', 'Melee', 'Precision'],
            Fortitude: ['Endurance', 'Strength', 'Willpower']
        };
        const focuses = {
            Adroitness: ['Skulduggery', 'Cleverness'],
            Expertise: ['Wizardry', 'Theurgy'],
            Perception: ['Alertness', 'Perspicacity'],
            Agility: ['Speed', 'Reaction'],
            Melee: ['Threat', 'Finesse'],
            Precision: ['Ranged Threat', 'Ranged Finesse'],
            Endurance: ['Vitality', 'Resilience'],
            Strength: ['Ferocity', 'Might'],
            Willpower: ['Courage', 'Resistance']
        };


        const races = ['Human', 'Elf', 'Dwarf', 'Gnome', 'Half-Elf', 'Half-Orc', 'Halfling'];
        const classes = ['Adept', 'Assassin', 'Barbarian', 'Mage', 'Mystic', 'Rogue', 'Theurgist', 'Warrior'];
        const levels = [1, 2, 3, 4, 5];


        const raceMinima = {
            Human: {},
            Elf: { Competence: 'd6', Expertise: 'd6', Perception: 'd4', Perspicacity: '+1' },
            Dwarf: { Fortitude: 'd8', Endurance: 'd4', Prowess: 'd6', Melee: 'd6' },
            Gnome: { Competence: 'd4', Adroitness: 'd6', Expertise: 'd6', Perception: 'd4', Perspicacity: '+1' },
            'Half-Elf': { Competence: 'd6', Prowess: 'd6', Agility: 'd4', Fortitude: 'd4', Endurance: 'd4', Willpower: 'd4' },
            'Half-Orc': { Fortitude: 'd6', Strength: 'd8', Ferocity: '+1', Endurance: 'd6' },
            Halfling: { Competence: 'd6', Adroitness: 'd6', Cleverness: '+1', Fortitude: 'd6', Willpower: 'd4', Courage: '+1' }
        };


        const classMinima = {
            Adept: { Competence: 'd6', Expertise: 'd6', Arcanum: '+1' },
            Assassin: { Competence: 'd4', Adroitness: 'd6', Perception: 'd4', Prowess: 'd4', Agility: 'd4', Vitality: 'd6', Melee: 'd4', Finesse: '+1', 'Ranged Finesse': '+1' },
            Barbarian: { Competence: 'd4', Intimidation: '+1', Prowess: 'd6', Agility: 'd6', Melee: 'd6', Threat: '+1', Ferocity: '+1', Fortitude: 'd8', Strength: 'd8', Might: '+1' },
            Mage: { Competence: 'd6', Expertise: 'd6', Arcanum: '+1', Prowess: 'd4', Agility: 'd4', Fortitude: 'd4', Willpower: 'd4' },
            Mystic: { Competence: 'd6', Expertise: 'd4', Lore: '+1', Prowess: 'd4', Agility: 'd4', Fortitude: 'd8', Willpower: 'd6', Resistance: '+1' },
            Rogue: { Competence: 'd6', Adroitness: 'd6', Skulduggery: '+1', Prowess: 'd6', Agility: 'd4', Vitality: 'd4', Fortitude: 'd4', Endurance: 'd4' },
            Theurgist: { Competence: 'd6', Expertise: 'd4', Theurgy: '+1', Prowess: 'd4', Agility: 'd4', Fortitude: 'd6', Willpower: 'd6', Courage: '+1' },
            Warrior: { Prowess: 'd8', Melee: 'd8', Threat: '+1', Fortitude: 'd6', Endurance: 'd6' }
        };


        const levelInfo = [
            { level: 1, cpRange: [10, 100], masteryDie: 'd4', usesPerDay: 2 },
            { level: 2, cpRange: [101, 199], masteryDie: 'd6', usesPerDay: 4 },
            { level: 3, cpRange: [200, 299], masteryDie: 'd8', usesPerDay: 6 },
            { level: 4, cpRange: [300, 399], masteryDie: 'd10', usesPerDay: 8 },
            { level: 5, cpRange: [400, 500], masteryDie: 'd12', usesPerDay: 10 }
        ];


        function populateDropdowns() {
            const raceSelect = document.getElementById('race');
            const classSelect = document.getElementById('class');
            const levelSelect = document.getElementById('level');


            races.forEach(race => {
                const option = document.createElement('option');
                option.value = race;
                option.textContent = race;
                raceSelect.appendChild(option);
            });


            classes.forEach(cls => {
                const option = document.createElement('option');
                option.value = cls;
                option.textContent = cls;
                classSelect.appendChild(option);
            });


            levels.forEach(level => {
                const option = document.createElement('option');
                option.value = level;
                option.textContent = level;
                levelSelect.appendChild(option);
            });
        }


        function getRandomElement(array) {
            return array[Math.floor(Math.random() * array.length)];
        }


        function getRandomDieRank() {
            return getRandomElement(dieRanks);
        }


        function getRandomFocusBonus() {
            return getRandomElement(focusBonuses);
        }


        function getHighestRank(rank1, rank2) {
            return dieRanks.indexOf(rank1) > dieRanks.indexOf(rank2) ? rank1 : rank2;
        }


        function getMasteryDie(level) {
            return levelInfo.find(info => info.level === level).masteryDie;
        }



        function generateCharacter() {
            const race = document.getElementById('race').value;
            const characterClass = document.getElementById('class').value;
            const level = parseInt(document.getElementById('level').value);
            if (!race || !characterClass || isNaN(level) || level < 1 || level > 5) {
                alert("Please select a valid race, class, and level (1-5).");
                return;
            }

            // Start with d4 in Competence, Prowess, Fortitude (per rules)
            const character = {
                race: race,
                class: characterClass,
                level: level,
                abilities: {},
                specialties: {},
                focuses: {},
                advantages: [],
                flaws: [],
                equipment: []
            };

            // Set base abilities to d4
            abilities.forEach(ability => {
                character.abilities[ability] = 'd4';
            });

            // Apply race minima
            Object.entries(raceMinima[race] || {}).forEach(([key, value]) => {
                if (abilities.includes(key)) {
                    character.abilities[key] = getHighestRank(character.abilities[key], value);
                } else if (Object.values(specialties).flat().includes(key)) {
                    // specialty
                    if (!character.specialties[getParentAbility(key)]) character.specialties[getParentAbility(key)] = {};
                    character.specialties[getParentAbility(key)][key] = value;
                } else {
                    // focus
                    let parentAbility = getParentAbilityFromFocus(key);
                    if (!character.focuses[parentAbility]) character.focuses[parentAbility] = {};
                    character.focuses[parentAbility][key] = value;
                }
            });

            // Apply class minima
            Object.entries(classMinima[characterClass] || {}).forEach(([key, value]) => {
                if (abilities.includes(key)) {
                    character.abilities[key] = getHighestRank(character.abilities[key], value);
                } else if (Object.values(specialties).flat().includes(key)) {
                    if (!character.specialties[getParentAbility(key)]) character.specialties[getParentAbility(key)] = {};
                    character.specialties[getParentAbility(key)][key] = value;
                } else {
                    let parentAbility = getParentAbilityFromFocus(key);
                    if (!character.focuses[parentAbility]) character.focuses[parentAbility] = {};
                    character.focuses[parentAbility][key] = value;
                }
            });

            // Fill in specialties and focuses with d4/+0 if not set
            abilities.forEach(ability => {
                if (!character.specialties[ability]) character.specialties[ability] = {};
                specialties[ability].forEach(specialty => {
                    if (!character.specialties[ability][specialty]) character.specialties[ability][specialty] = 'd4';
                    if (!character.focuses[ability]) character.focuses[ability] = {};
                    focuses[specialty].forEach(focus => {
                        if (!character.focuses[ability][focus]) character.focuses[ability][focus] = '+0';
                    });
                });
            });

            // TODO: Spend 10 CPs to upgrade abilities/specialties/focuses (random or user-driven)

            // Calculate defense pools using MV (max value) per rules
            character.defensePools = calculateDefensePoolsMV(character);

            // Add starting equipment and advantages/flaws per race/class
            character.equipment = getStartingEquipment(race, characterClass);
            character.advantages = getAdvantages(race, characterClass);
            character.flaws = getFlaws(race, characterClass);

            character.cp = calculateCP(character); // CP calculation may need update for new logic
            character.masteryDie = getMasteryDie(character.level);
            character.usesPerDay = levelInfo.find(info => info.level === character.level).usesPerDay;

            displayCharacter(character);
        }

        // Helper: get parent ability for specialty
        function getParentAbility(specialty) {
            for (let ability in specialties) {
                if (specialties[ability].includes(specialty)) return ability;
            }
            return null;
        }
        // Helper: get parent ability for focus
        function getParentAbilityFromFocus(focus) {
            for (let specialty in focuses) {
                if (focuses[specialty].includes(focus)) {
                    return getParentAbility(specialty);
                }
            }
            return null;
        }

        // Calculate defense pools using MV (max value)
        function getDieMV(rank) {
            switch(rank) {
                case 'd4': return 4;
                case 'd6': return 6;
                case 'd8': return 8;
                case 'd10': return 10;
                case 'd12': return 12;
                default: return 0;
            }
        }

        function calculateDefensePoolsMV(character) {
            // Active: Prowess MV + Agility MV + Melee MV
            let active = getDieMV(character.abilities['Prowess']) +
                         getDieMV(character.specialties['Prowess']['Agility']) +
                         getDieMV(character.specialties['Prowess']['Melee']);
            // Passive: Fortitude MV + Endurance MV + Strength MV
            let passive = getDieMV(character.abilities['Fortitude']) +
                          getDieMV(character.specialties['Fortitude']['Endurance']) +
                          getDieMV(character.specialties['Fortitude']['Strength']);
            // Spirit: Competence MV + Willpower MV
            let spirit = getDieMV(character.abilities['Competence']) +
                         getDieMV(character.specialties['Fortitude']['Willpower']);
            return { activeDefense: active, passiveDefense: passive, spiritPoints: spirit };
        }

        // Get starting equipment per race/class
        function getStartingEquipment(race, characterClass) {
            // Per rules, simplified
            const raceEq = {
                Human: ['Ordinary clothes', '5 gold coins', 'Backpack', 'Small dagger', 'Week rations', 'Waterskin', 'Tinderbox', 'Rope', 'Iron spikes', 'Small hammer', 'Traveling staff or pole', 'Lantern/torches'],
                Elf: ['Ordinary clothes', '5 gold coins', 'Backpack', 'Small dagger', 'Week rations', 'Waterskin', 'Tinderbox', 'Rope', 'Iron spikes', 'Small hammer', 'Traveling staff or pole', 'Lantern/torches'],
                Dwarf: ['Ordinary clothes', '5 gold coins', 'Backpack', 'Small dagger', 'Week rations', 'Waterskin', 'Tinderbox', 'Rope', 'Iron spikes', 'Small hammer', 'Traveling staff or pole', 'Lantern/torches'],
                Gnome: ['Ordinary clothes', '5 gold coins', 'Backpack', 'Small dagger', 'Week rations', 'Waterskin', 'Tinderbox', 'Rope', 'Iron spikes', 'Small hammer', 'Traveling staff or pole', 'Lantern/torches'],
                'Half-Elf': ['Ordinary clothes', '5 gold coins', 'Backpack', 'Small dagger', 'Week rations', 'Waterskin', 'Tinderbox', 'Rope', 'Iron spikes', 'Small hammer', 'Traveling staff or pole', 'Lantern/torches'],
                'Half-Orc': ['Ordinary clothes', '5 gold coins', 'Backpack', 'Small dagger', 'Week rations', 'Waterskin', 'Tinderbox', 'Rope', 'Iron spikes', 'Small hammer', 'Traveling staff or pole', 'Lantern/torches'],
                Halfling: ['Ordinary clothes', '5 gold coins', 'Backpack', 'Small dagger', 'Week rations', 'Waterskin', 'Tinderbox', 'Rope', 'Iron spikes', 'Small hammer', 'Traveling staff or pole', 'Lantern/torches']
            };
            const classEq = {
                Adept: ['Book of knowledge (area of expertise)'],
                Assassin: ['Assassin hood/jacket/cape/robe/tunic'],
                Barbarian: ['Wool/linen garments', 'Tunic', 'Overcoat/cloak'],
                Mage: ['Spellbook', 'Staff or focus item'],
                Mystic: ['Robes/shawl/cloak', 'Armor up to leather'],
                Rogue: ['Thieves tools', 'Light armor (leather)', 'Weapon'],
                Theurgist: ['Prayer book', 'Holy relic/symbol', 'Focus item', 'Armor up to chain'],
                Warrior: ['Weapon of choice', 'Armor up to chain', 'Shield', 'Steed']
            };
            return [...(raceEq[race] || []), ...(classEq[characterClass] || [])];
        }

        // Get advantages per race/class (simplified)
        function getAdvantages(race, characterClass) {
            const raceAdv = {
                Human: ['Fortunate', 'Survival'],
                Elf: ['Night Vision', 'Gift of Magic', 'Magic Resistance (+1)'],
                Dwarf: ['Night Vision', 'Strong-willed', 'Sense of Direction'],
                Gnome: ['Eidetic Memory', 'Low-Light Vision', 'Observant'],
                'Half-Elf': ['Heightened Senses', 'Low-Light Vision', 'Magic Resistance (+1)'],
                'Half-Orc': ['Low-light Vision', 'Intimidation', 'Menacing'],
                Halfling: ['Low Light Vision', 'Read Emotions', 'Resilient']
            };
            const classAdv = {
                Adept: ['Arcanum', 'Gift of Magic', 'Literacy', 'Scholar'],
                Assassin: ['Expeditious', 'Heightened Senses (hearing)', 'Observant', 'Read Emotions'],
                Barbarian: ['Animal Affinity', 'Brutishness', 'Menacing', 'Resilient'],
                Mage: ['Arcanum', 'Gift of Magic', 'Magic Defense', 'Scholar'],
                Mystic: ['Empathic', 'Gift of Magic', 'Intuitive', 'Magic Resistance (Lesser)', 'Strong-Willed'],
                Rogue: ['Expeditious', 'Fortunate', 'Streetwise', 'Underworld Contacts'],
                Theurgist: ['Gift of Magic', 'Magic Defense', 'Religion', 'Strong-Willed'],
                Warrior: ['Commanding', 'Intimidation', 'Magic Resistance (+1)', 'Tactician']
            };
            return [...(raceAdv[race] || []), ...(classAdv[characterClass] || [])];
        }

        // Get flaws per race/class (simplified)
        function getFlaws(race, characterClass) {
            const raceFlaw = {
                Gnome: ['Restriction: small weapons only'],
                Halfling: ['Restriction: small weapons only'],
                'Half-Orc': ['Ugliness']
            };
            return [...(raceFlaw[race] || [])];
        }


    function calculateCP(character) {
        let cp = 10; // Starting CP
        abilities.forEach(ability => {
            cp += dieRanks.indexOf(character.abilities[ability]) * 2;
            Object.values(character.specialties[ability]).forEach(specialty => {
                cp += dieRanks.indexOf(specialty) * 2;
            });
            Object.values(character.focuses[ability]).forEach(focus => {
                cp += parseInt(focus.substring(1)) * 4;
            });
        });
        // Add CPs for levels beyond 1
        cp += (character.level - 1) * 100;
        return cp;
    }


    function calculateDefensePools(character) {
        const activeDefense = (dieRanks.indexOf(character.abilities['Prowess']) + 4) +
                              (dieRanks.indexOf(character.specialties['Prowess']['Agility']) + 4) +
                              (dieRanks.indexOf(character.specialties['Prowess']['Melee']) + 4);
        
        const passiveDefense = (dieRanks.indexOf(character.abilities['Fortitude']) + 4) +
                               (dieRanks.indexOf(character.specialties['Fortitude']['Endurance']) + 4) +
                               (dieRanks.indexOf(character.specialties['Fortitude']['Strength']) + 4);
        
        const spiritPoints = (dieRanks.indexOf(character.abilities['Competence']) + 4) +
                             (dieRanks.indexOf(character.specialties['Fortitude']['Willpower']) + 4);
        
        return { activeDefense, passiveDefense, spiritPoints };
    }



        function displayCharacter(character) {
            const output = document.getElementById('character-output');
            output.innerHTML = `
                <h2>Generated Eldritch RPG 2nd Edition Character</h2>
                <p><strong>Race:</strong> ${character.race}</p>
                <p><strong>Class:</strong> ${character.class}</p>
                <p><strong>Level:</strong> ${character.level}</p>
                <p><strong>Character Points:</strong> ${character.cp}</p>
                <p><strong>Mastery Die:</strong> ${character.masteryDie}</p>
                <p><strong>Uses Per Day:</strong> ${character.usesPerDay}</p>
                <h3>Abilities</h3>
                <ul>
                    ${abilities.map(ability => `<li><strong>${ability}:</strong> ${character.abilities[ability]}</li>`).join('')}
                </ul>
                <h3>Specialties</h3>
                <ul>
                    ${abilities.map(ability => specialties[ability].map(specialty => `<li><strong>${specialty} (${ability}):</strong> ${character.specialties[ability][specialty]}</li>`).join('')).join('')}
                </ul>
                <h3>Focuses</h3>
                <ul>
                    ${abilities.map(ability => specialties[ability].map(specialty => focuses[specialty].map(focus => `<li><strong>${focus} (${specialty}):</strong> ${character.focuses[ability][focus]}</li>`).join('')).join('')).join('')}
                </ul>
                <h3>Defense Pools</h3>
                <ul>
                    <li><strong>Active Defense:</strong> ${character.defensePools.activeDefense}</li>
                    <li><strong>Passive Defense:</strong> ${character.defensePools.passiveDefense}</li>
                    <li><strong>Spirit Points:</strong> ${character.defensePools.spiritPoints}</li>
                </ul>
                <h3>Advantages</h3>
                <ul>
                    ${character.advantages.map(adv => `<li>${adv}</li>`).join('')}
                </ul>
                <h3>Flaws</h3>
                <ul>
                    ${character.flaws.length ? character.flaws.map(flaw => `<li>${flaw}</li>`).join('') : '<li>None</li>'}
                </ul>
                <h3>Starting Equipment</h3>
                <ul>
                    ${character.equipment.map(eq => `<li>${eq}</li>`).join('')}
                </ul>
            `;
        }


    // Call populateDropdowns when the page loads
    window.onload = populateDropdowns;
</script>
</body>
</html>
```